transferring data
Sun Jul  4 20:15:19 PDT 2021

Finished transferring
Sun Jul  4 20:15:22 PDT 2021

Adas: Argument Parser Options
---------------------------------------------
    config              : PostTrainingConfigs/CRC_transformed_testing/AdamP/lr-0.0001-config-AdamP.yaml
    data                : /localscratch/zhan8425.6958616.0        
    output              : ADP_post_trained/CRC_transformed/AdamP/output/fine_tuning
    checkpoint          : ADP_post_trained/CRC_transformed/AdamP/checkpoint/fine_tuning/lr-0.0001
    resume              : None                                    
    pretrained_model    : /home/zhan8425/projects/def-plato/zhan8425/HistoKT/.Adas-checkpoint/ADP/best_trial_2.pth.tar
    freeze_encoder      : 1                                       
    root                : .                                       
    save_freq           : 25                                      
    cpu                 : 0                                       
    gpu                 : 0                                       
    mpd                 : 0                                       
    dist_url            : tcp://127.0.0.1:23456                   
    dist_backend        : nccl                                    
    world_size          : -1                                      
    rank                : -1                                      
---------------------------------------------
Adas: Output dir ADP_post_trained/CRC_transformed/AdamP/output/fine_tuning does not exist, building
Adas: Notice: early stop will not be used as it was set to -1.0, training till completion
Adas: Experiment Configuration
---------------------------------------------
    dataset              CRC_transformed     
    network              ResNet18            
    optimizer            AdamP               
    scheduler            None                
    level                L3Only              
    color_kwargs         {'augmentation': 'Color-Distortion', 'distortion': 0.3}
    degree_of_rotation   45                  
    vertical_flipping    0.5                 
    horizontal_flipping  0.5                 
    horizontal_shift     0.1                 
    vertical_shift       0.1                 
    gaussian_blur        0                   
    kernel_size          9                   
    variance             0.1                 
    cutout               0                   
    n_holes              1                   
    cutout_length        16                  
    init_lr              0.0001              
    early_stop_threshold -1.0                
    optimizer_kwargs     {'weight_decay': 0.0005}
    scheduler_kwargs     {'gamma': 0.5, 'step_size': 20.0}
    p                    1                   
    start_trial          0                   
    n_trials             3                   
    num_workers          4                   
    max_epochs           200                 
    mini_batch_size      32                  
    loss                 cross_entropy       
    early_stop_patience  10                  
---------------------------------------------
Adas: Pytorch device is set to cuda
AdamP on CRC_transformed: T 1/3 | E 1/200 Ended | E Time: 59.975s | ~Time Left: 11935.046s |  Train Loss: 0.8668 | Train Acc. 66.6286% | Test Loss: 0.6156 | Test Acc. 78.9286%
AdamP on CRC_transformed: T 1/3 | E 2/200 Ended | E Time: 59.161s | ~Time Left: 11713.815s |  Train Loss: 0.6123 | Train Acc. 77.2500% | Test Loss: 0.6712 | Test Acc. 76.1429%
AdamP on CRC_transformed: T 1/3 | E 3/200 Ended | E Time: 58.987s | ~Time Left: 11620.481s |  Train Loss: 0.4863 | Train Acc. 82.4143% | Test Loss: 0.3532 | Test Acc. 87.0000%
AdamP on CRC_transformed: T 1/3 | E 4/200 Ended | E Time: 59.049s | ~Time Left: 11573.619s |  Train Loss: 0.3927 | Train Acc. 85.9714% | Test Loss: 0.2763 | Test Acc. 90.2857%
AdamP on CRC_transformed: T 1/3 | E 5/200 Ended | E Time: 59.263s | ~Time Left: 11556.189s |  Train Loss: 0.3359 | Train Acc. 87.9143% | Test Loss: 0.3077 | Test Acc. 88.7857%
AdamP on CRC_transformed: T 1/3 | E 6/200 Ended | E Time: 58.998s | ~Time Left: 11445.558s |  Train Loss: 0.2948 | Train Acc. 89.8071% | Test Loss: 0.2822 | Test Acc. 89.8571%
AdamP on CRC_transformed: T 1/3 | E 7/200 Ended | E Time: 59.182s | ~Time Left: 11422.208s |  Train Loss: 0.2624 | Train Acc. 90.7929% | Test Loss: 0.2021 | Test Acc. 93.1429%
AdamP on CRC_transformed: T 1/3 | E 8/200 Ended | E Time: 58.914s | ~Time Left: 11311.524s |  Train Loss: 0.2573 | Train Acc. 90.8857% | Test Loss: 0.2413 | Test Acc. 91.0714%
AdamP on CRC_transformed: T 1/3 | E 9/200 Ended | E Time: 58.880s | ~Time Left: 11246.118s |  Train Loss: 0.2341 | Train Acc. 91.7357% | Test Loss: 1.0908 | Test Acc. 77.3571%
AdamP on CRC_transformed: T 1/3 | E 10/200 Ended | E Time: 59.047s | ~Time Left: 11218.999s |  Train Loss: 0.2332 | Train Acc. 92.0214% | Test Loss: 0.2268 | Test Acc. 92.6429%
AdamP on CRC_transformed: T 1/3 | E 11/200 Ended | E Time: 59.040s | ~Time Left: 11158.507s |  Train Loss: 0.2109 | Train Acc. 92.7000% | Test Loss: 0.1480 | Test Acc. 95.7143%
AdamP on CRC_transformed: T 1/3 | E 12/200 Ended | E Time: 59.047s | ~Time Left: 11100.885s |  Train Loss: 0.1968 | Train Acc. 93.2643% | Test Loss: 0.1520 | Test Acc. 94.8571%
AdamP on CRC_transformed: T 1/3 | E 13/200 Ended | E Time: 59.030s | ~Time Left: 11038.703s |  Train Loss: 0.1880 | Train Acc. 93.5714% | Test Loss: 0.1577 | Test Acc. 94.5000%
AdamP on CRC_transformed: T 1/3 | E 14/200 Ended | E Time: 59.082s | ~Time Left: 10989.318s |  Train Loss: 0.1887 | Train Acc. 93.3000% | Test Loss: 0.1284 | Test Acc. 96.2143%
AdamP on CRC_transformed: T 1/3 | E 15/200 Ended | E Time: 59.112s | ~Time Left: 10935.720s |  Train Loss: 0.1738 | Train Acc. 94.1786% | Test Loss: 0.1581 | Test Acc. 94.5000%
AdamP on CRC_transformed: T 1/3 | E 16/200 Ended | E Time: 59.206s | ~Time Left: 10893.886s |  Train Loss: 0.1849 | Train Acc. 93.8357% | Test Loss: 0.1463 | Test Acc. 95.5714%
AdamP on CRC_transformed: T 1/3 | E 17/200 Ended | E Time: 59.176s | ~Time Left: 10829.131s |  Train Loss: 0.1607 | Train Acc. 94.4000% | Test Loss: 0.1333 | Test Acc. 96.0000%
AdamP on CRC_transformed: T 1/3 | E 18/200 Ended | E Time: 59.165s | ~Time Left: 10768.088s |  Train Loss: 0.1637 | Train Acc. 94.4714% | Test Loss: 0.2199 | Test Acc. 92.6429%
AdamP on CRC_transformed: T 1/3 | E 19/200 Ended | E Time: 59.089s | ~Time Left: 10695.069s |  Train Loss: 0.1610 | Train Acc. 94.6143% | Test Loss: 0.1158 | Test Acc. 95.8571%
AdamP on CRC_transformed: T 1/3 | E 20/200 Ended | E Time: 59.168s | ~Time Left: 10650.220s |  Train Loss: 0.1610 | Train Acc. 94.4643% | Test Loss: 0.1288 | Test Acc. 95.4286%
AdamP on CRC_transformed: T 1/3 | E 21/200 Ended | E Time: 59.207s | ~Time Left: 10598.017s |  Train Loss: 0.1514 | Train Acc. 94.9000% | Test Loss: 0.1764 | Test Acc. 94.1429%
AdamP on CRC_transformed: T 1/3 | E 22/200 Ended | E Time: 59.044s | ~Time Left: 10509.746s |  Train Loss: 0.1497 | Train Acc. 94.8786% | Test Loss: 0.1231 | Test Acc. 95.9286%
AdamP on CRC_transformed: T 1/3 | E 23/200 Ended | E Time: 59.259s | ~Time Left: 10488.928s |  Train Loss: 0.1483 | Train Acc. 94.7571% | Test Loss: 0.1630 | Test Acc. 93.9286%
AdamP on CRC_transformed: T 1/3 | E 24/200 Ended | E Time: 59.254s | ~Time Left: 10428.618s |  Train Loss: 0.1441 | Train Acc. 95.0643% | Test Loss: 0.1067 | Test Acc. 96.7857%
AdamP on CRC_transformed: T 1/3 | E 25/200 Ended | E Time: 59.321s | ~Time Left: 10381.255s |  Train Loss: 0.1402 | Train Acc. 95.0143% | Test Loss: 0.1972 | Test Acc. 93.1429%
AdamP on CRC_transformed: T 1/3 | E 26/200 Ended | E Time: 59.184s | ~Time Left: 10297.965s |  Train Loss: 0.1330 | Train Acc. 95.4571% | Test Loss: 0.0984 | Test Acc. 96.9286%
AdamP on CRC_transformed: T 1/3 | E 27/200 Ended | E Time: 59.229s | ~Time Left: 10246.665s |  Train Loss: 0.1350 | Train Acc. 95.4643% | Test Loss: 0.0893 | Test Acc. 97.0714%
AdamP on CRC_transformed: T 1/3 | E 28/200 Ended | E Time: 59.142s | ~Time Left: 10172.495s |  Train Loss: 0.1315 | Train Acc. 95.4429% | Test Loss: 0.0938 | Test Acc. 97.0000%
AdamP on CRC_transformed: T 1/3 | E 29/200 Ended | E Time: 59.171s | ~Time Left: 10118.196s |  Train Loss: 0.1274 | Train Acc. 95.4500% | Test Loss: 0.1369 | Test Acc. 95.5714%
AdamP on CRC_transformed: T 1/3 | E 30/200 Ended | E Time: 59.260s | ~Time Left: 10074.243s |  Train Loss: 0.1180 | Train Acc. 96.1357% | Test Loss: 0.1623 | Test Acc. 94.8571%
AdamP on CRC_transformed: T 1/3 | E 31/200 Ended | E Time: 59.259s | ~Time Left: 10014.775s |  Train Loss: 0.1240 | Train Acc. 95.7000% | Test Loss: 0.1133 | Test Acc. 96.3571%
AdamP on CRC_transformed: T 1/3 | E 32/200 Ended | E Time: 59.171s | ~Time Left: 9940.812s |  Train Loss: 0.1141 | Train Acc. 96.2143% | Test Loss: 0.0986 | Test Acc. 96.8571%
AdamP on CRC_transformed: T 1/3 | E 33/200 Ended | E Time: 59.062s | ~Time Left: 9863.364s |  Train Loss: 0.1142 | Train Acc. 95.9929% | Test Loss: 0.2585 | Test Acc. 92.0000%
AdamP on CRC_transformed: T 1/3 | E 34/200 Ended | E Time: 59.116s | ~Time Left: 9813.322s |  Train Loss: 0.1143 | Train Acc. 96.0429% | Test Loss: 0.2124 | Test Acc. 93.6429%
AdamP on CRC_transformed: T 1/3 | E 35/200 Ended | E Time: 59.143s | ~Time Left: 9758.522s |  Train Loss: 0.1121 | Train Acc. 96.2571% | Test Loss: 0.1491 | Test Acc. 94.7143%
AdamP on CRC_transformed: T 1/3 | E 36/200 Ended | E Time: 59.141s | ~Time Left: 9699.199s |  Train Loss: 0.1049 | Train Acc. 96.4143% | Test Loss: 0.1399 | Test Acc. 95.3571%
AdamP on CRC_transformed: T 1/3 | E 37/200 Ended | E Time: 59.339s | ~Time Left: 9672.251s |  Train Loss: 0.1137 | Train Acc. 96.1643% | Test Loss: 0.1223 | Test Acc. 95.6429%
AdamP on CRC_transformed: T 1/3 | E 38/200 Ended | E Time: 59.105s | ~Time Left: 9574.968s |  Train Loss: 0.1085 | Train Acc. 96.1929% | Test Loss: 0.1194 | Test Acc. 96.7143%
AdamP on CRC_transformed: T 1/3 | E 39/200 Ended | E Time: 59.345s | ~Time Left: 9554.581s |  Train Loss: 0.0956 | Train Acc. 96.6929% | Test Loss: 0.0914 | Test Acc. 97.0714%
AdamP on CRC_transformed: T 1/3 | E 40/200 Ended | E Time: 59.152s | ~Time Left: 9464.301s |  Train Loss: 0.0985 | Train Acc. 96.4357% | Test Loss: 0.0873 | Test Acc. 97.0000%
AdamP on CRC_transformed: T 1/3 | E 41/200 Ended | E Time: 59.345s | ~Time Left: 9435.850s |  Train Loss: 0.0998 | Train Acc. 96.5857% | Test Loss: 0.0939 | Test Acc. 97.0714%
AdamP on CRC_transformed: T 1/3 | E 42/200 Ended | E Time: 59.271s | ~Time Left: 9364.755s |  Train Loss: 0.0984 | Train Acc. 96.6286% | Test Loss: 0.1101 | Test Acc. 96.7143%
AdamP on CRC_transformed: T 1/3 | E 43/200 Ended | E Time: 59.382s | ~Time Left: 9322.982s |  Train Loss: 0.0951 | Train Acc. 96.5857% | Test Loss: 0.0888 | Test Acc. 97.0000%
AdamP on CRC_transformed: T 1/3 | E 44/200 Ended | E Time: 59.354s | ~Time Left: 9259.287s |  Train Loss: 0.0960 | Train Acc. 96.6571% | Test Loss: 0.1197 | Test Acc. 95.7857%
AdamP on CRC_transformed: T 1/3 | E 45/200 Ended | E Time: 59.178s | ~Time Left: 9172.540s |  Train Loss: 0.0900 | Train Acc. 96.9429% | Test Loss: 0.0753 | Test Acc. 97.2857%
AdamP on CRC_transformed: T 1/3 | E 46/200 Ended | E Time: 59.166s | ~Time Left: 9111.544s |  Train Loss: 0.0894 | Train Acc. 96.9143% | Test Loss: 0.1492 | Test Acc. 96.0714%
AdamP on CRC_transformed: T 1/3 | E 47/200 Ended | E Time: 59.060s | ~Time Left: 9036.214s |  Train Loss: 0.0980 | Train Acc. 96.5143% | Test Loss: 0.1010 | Test Acc. 96.5000%
AdamP on CRC_transformed: T 1/3 | E 48/200 Ended | E Time: 59.212s | ~Time Left: 9000.217s |  Train Loss: 0.0842 | Train Acc. 97.1286% | Test Loss: 0.1337 | Test Acc. 95.9286%
AdamP on CRC_transformed: T 1/3 | E 49/200 Ended | E Time: 58.974s | ~Time Left: 8905.001s |  Train Loss: 0.0969 | Train Acc. 96.6429% | Test Loss: 0.0939 | Test Acc. 96.6429%
AdamP on CRC_transformed: T 1/3 | E 50/200 Ended | E Time: 59.116s | ~Time Left: 8867.402s |  Train Loss: 0.0855 | Train Acc. 97.1214% | Test Loss: 0.0810 | Test Acc. 97.6429%
AdamP on CRC_transformed: T 1/3 | E 51/200 Ended | E Time: 59.325s | ~Time Left: 8839.452s |  Train Loss: 0.0846 | Train Acc. 96.9714% | Test Loss: 0.0699 | Test Acc. 97.8571%
AdamP on CRC_transformed: T 1/3 | E 52/200 Ended | E Time: 59.250s | ~Time Left: 8768.992s |  Train Loss: 0.0793 | Train Acc. 97.2214% | Test Loss: 0.0813 | Test Acc. 97.0000%
AdamP on CRC_transformed: T 1/3 | E 53/200 Ended | E Time: 59.083s | ~Time Left: 8685.269s |  Train Loss: 0.0810 | Train Acc. 97.2929% | Test Loss: 0.1056 | Test Acc. 96.6429%
AdamP on CRC_transformed: T 1/3 | E 54/200 Ended | E Time: 59.393s | ~Time Left: 8671.448s |  Train Loss: 0.0811 | Train Acc. 97.2071% | Test Loss: 0.1113 | Test Acc. 96.0000%
AdamP on CRC_transformed: T 1/3 | E 55/200 Ended | E Time: 59.157s | ~Time Left: 8577.721s |  Train Loss: 0.0726 | Train Acc. 97.3786% | Test Loss: 0.0728 | Test Acc. 97.4286%
Adas: Argument Parser Options
---------------------------------------------
    config              : PostTrainingConfigs/CRC_transformed_testing/AdamP/lr-0.0001-config-AdamP.yaml
    data                : /localscratch/zhan8425.6958616.0        
    output              : ADP_post_trained/CRC_transformed/AdamP/output/deep_tuning
    checkpoint          : ADP_post_trained/CRC_transformed/AdamP/checkpoint/deep_tuning/lr-0.0001
    resume              : None                                    
    pretrained_model    : /home/zhan8425/projects/def-plato/zhan8425/HistoKT/.Adas-checkpoint/ADP/best_trial_2.pth.tar
    freeze_encoder      : 0                                       
    root                : .                                       
    save_freq           : 25                                      
    cpu                 : 0                                       
    gpu                 : 0                                       
    mpd                 : 0                                       
    dist_url            : tcp://127.0.0.1:23456                   
    dist_backend        : nccl                                    
    world_size          : -1                                      
    rank                : -1                                      
---------------------------------------------
Adas: Notice: early stop will not be used as it was set to -1.0, training till completion
Adas: Experiment Configuration
---------------------------------------------
    dataset              CRC_transformed     
    network              ResNet18            
    optimizer            AdamP               
    scheduler            None                
    level                L3Only              
    color_kwargs         {'augmentation': 'Color-Distortion', 'distortion': 0.3}
    degree_of_rotation   45                  
    vertical_flipping    0.5                 
    horizontal_flipping  0.5                 
    horizontal_shift     0.1                 
    vertical_shift       0.1                 
    gaussian_blur        0                   
    kernel_size          9                   
    variance             0.1                 
    cutout               0                   
    n_holes              1                   
    cutout_length        16                  
    init_lr              0.0001              
    early_stop_threshold -1.0                
    optimizer_kwargs     {'weight_decay': 0.0005}
    scheduler_kwargs     {'gamma': 0.5, 'step_size': 20.0}
    p                    1                   
    start_trial          0                   
    n_trials             3                   
    num_workers          4                   
    max_epochs           200                 
    mini_batch_size      32                  
    loss                 cross_entropy       
    early_stop_patience  10                  
---------------------------------------------
Adas: Pytorch device is set to cuda
AdamP on CRC_transformed: T 1/3 | E 1/200 Ended | E Time: 60.065s | ~Time Left: 11952.990s |  Train Loss: 0.9040 | Train Acc. 65.1714% | Test Loss: 0.6541 | Test Acc. 74.9286%
Traceback (most recent call last):
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 372, in save
    _save(obj, opened_zipfile, pickle_module, pickle_protocol)
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 491, in _save
    zip_file.write_record(name, storage.data_ptr(), num_bytes)
OSError: [Errno 122] Disk quota exceeded

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 373, in save
    return
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 259, in __exit__
    self.file_like.write_end_of_file()
RuntimeError: [enforce fail at inline_container.cc:274] . unexpected pos 4916096 vs 4915984

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "src/adas/train.py", line 871, in <module>
    main(args)
  File "src/adas/train.py", line 834, in main
    main_worker(args.gpu, ngpus_per_node, args)
  File "src/adas/train.py", line 863, in main_worker
    training_agent.train()
  File "src/adas/train.py", line 411, in train
    self.run_epochs(trial, epochs)
  File "src/adas/train.py", line 462, in run_epochs
    torch.save(data, str(self.checkpoint_path / filename))
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 374, in save
    _legacy_save(obj, opened_file, pickle_module, pickle_protocol)
  File "/project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/serialization.py", line 214, in __exit__
    self.file_like.close()
OSError: [Errno 122] Disk quota exceeded
terminate called after throwing an instance of 'c10::Error'
  what():  [enforce fail at inline_container.cc:274] . unexpected pos 4916096 vs 4915984
frame #0: c10::ThrowEnforceNotMet(char const*, int, char const*, std::string const&, void const*) + 0x47 (0x2af6a369b0e7 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libc10.so)
frame #1: <unknown function> + 0x206a420 (0x2af65382f420 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_cpu.so)
frame #2: <unknown function> + 0x20665f3 (0x2af65382b5f3 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_cpu.so)
frame #3: caffe2::serialize::PyTorchStreamWriter::writeRecord(std::string const&, void const*, unsigned long, bool) + 0xa9 (0x2af65382fd99 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_cpu.so)
frame #4: caffe2::serialize::PyTorchStreamWriter::writeEndOfFile() + 0xe1 (0x2af6538308d1 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_cpu.so)
frame #5: caffe2::serialize::PyTorchStreamWriter::~PyTorchStreamWriter() + 0x115 (0x2af6538310c5 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_cpu.so)
frame #6: <unknown function> + 0x737903 (0x2af6506fc903 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_python.so)
frame #7: <unknown function> + 0x369b90 (0x2af65032eb90 in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_python.so)
frame #8: <unknown function> + 0x36adfe (0x2af65032fdfe in /project/6060173/zhan8425/HistoKT/ENV/lib/python3.8/site-packages/torch/lib/libtorch_python.so)
<omitting python frames>
frame #22: __libc_start_main + 0xeb (0x2af64dc14e1b in /cvmfs/soft.computecanada.ca/gentoo/2020/lib64/libc.so.6)

/var/spool/slurmd/job6958616/slurm_script: line 31: 198132 Aborted                 (core dumped) python src/adas/train.py --config PostTrainingConfigs/CRC_transformed_testing/AdamP/lr-0.0001-config-AdamP.yaml --output ADP_post_trained/CRC_transformed/AdamP/output/deep_tuning --checkpoint ADP_post_trained/CRC_transformed/AdamP/checkpoint/deep_tuning/lr-0.0001 --data $SLURM_TMPDIR --pretrained_model /home/zhan8425/projects/def-plato/zhan8425/HistoKT/.Adas-checkpoint/ADP/best_trial_2.pth.tar --freeze_encoder False
